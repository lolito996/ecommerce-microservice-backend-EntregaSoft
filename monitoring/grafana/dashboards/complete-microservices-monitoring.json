{
  "dashboard": {
    "title": "Complete Microservices Monitoring",
    "tags": ["microservices", "monitoring", "ecommerce"],
    "timezone": "browser",
    "schemaVersion": 27,
    "version": 1,
    "refresh": "30s",
    "panels": [
      {
        "id": 1,
        "title": "Services Health Status",
        "type": "stat",
        "gridPos": {"h": 6, "w": 24, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "up{job=~\".*service.*\"}",
            "legendFormat": "{{job}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 1, "color": "green"}
              ]
            },
            "mappings": [
              {"type": "value", "options": {"0": {"text": "DOWN"}}},
              {"type": "value", "options": {"1": {"text": "UP"}}}
            ]
          }
        }
      },
      {
        "id": 2,
        "title": "HTTP Request Rate per Service",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=~\".*service.*\"}[5m])) by (job)",
            "legendFormat": "{{job}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "reqps", "label": "Requests/sec"},
          {"format": "short"}
        ]
      },
      {
        "id": 3,
        "title": "HTTP Response Time (P95) per Service",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket{job=~\".*service.*\"}[5m])) by (le, job))",
            "legendFormat": "{{job}} - p95",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "s", "label": "Response Time"},
          {"format": "short"}
        ]
      },
      {
        "id": 4,
        "title": "API Gateway - Request Rate",
        "type": "graph",
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 14},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=\"dev-api-gateway\"}[5m])) by (uri, method)",
            "legendFormat": "{{method}} {{uri}}",
            "refId": "A"
          }
        ]
      },
      {
        "id": 5,
        "title": "User Service - Operations",
        "type": "graph",
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 14},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=\"dev-user-service\"}[5m])) by (uri, status)",
            "legendFormat": "{{uri}} [{{status}}]",
            "refId": "A"
          }
        ]
      },
      {
        "id": 6,
        "title": "Product Service - Operations",
        "type": "graph",
        "gridPos": {"h": 8, "w": 8, "x": 16, "y": 14},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=\"dev-product-service\"}[5m])) by (uri, status)",
            "legendFormat": "{{uri}} [{{status}}]",
            "refId": "A"
          }
        ]
      },
      {
        "id": 7,
        "title": "Order Service - Orders Processed",
        "type": "graph",
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 22},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=\"dev-order-service\"}[5m])) by (uri, status)",
            "legendFormat": "{{uri}} [{{status}}]",
            "refId": "A"
          }
        ]
      },
      {
        "id": 8,
        "title": "Payment Service - Transactions",
        "type": "graph",
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 22},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=\"dev-payment-service\"}[5m])) by (uri, status)",
            "legendFormat": "{{uri}} [{{status}}]",
            "refId": "A"
          }
        ]
      },
      {
        "id": 9,
        "title": "Shipping Service - Shipments",
        "type": "graph",
        "gridPos": {"h": 8, "w": 8, "x": 16, "y": 22},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=\"dev-shipping-service\"}[5m])) by (uri, status)",
            "legendFormat": "{{uri}} [{{status}}]",
            "refId": "A"
          }
        ]
      },
      {
        "id": 10,
        "title": "JVM Memory Usage by Service",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 30},
        "targets": [
          {
            "expr": "sum(jvm_memory_used_bytes{area=\"heap\", job=~\".*service.*\"}) by (job)",
            "legendFormat": "{{job}} - Heap",
            "refId": "A"
          },
          {
            "expr": "sum(jvm_memory_max_bytes{area=\"heap\", job=~\".*service.*\"}) by (job)",
            "legendFormat": "{{job}} - Max",
            "refId": "B"
          }
        ],
        "yaxes": [
          {"format": "bytes", "label": "Memory"},
          {"format": "short"}
        ]
      },
      {
        "id": 11,
        "title": "CPU Usage by Service",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 30},
        "targets": [
          {
            "expr": "rate(process_cpu_seconds_total{job=~\".*service.*\"}[5m]) * 100",
            "legendFormat": "{{job}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "percent", "label": "CPU %"},
          {"format": "short"}
        ]
      },
      {
        "id": 12,
        "title": "HTTP Errors by Service (4xx & 5xx)",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 38},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=~\".*service.*\", status=~\"4..|5..\"}[5m])) by (job, status)",
            "legendFormat": "{{job}} - {{status}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "reqps", "label": "Errors/sec"},
          {"format": "short"}
        ]
      },
      {
        "id": 13,
        "title": "Database Connection Pool - Active Connections",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 38},
        "targets": [
          {
            "expr": "hikaricp_connections_active{job=~\".*service.*\"}",
            "legendFormat": "{{job}} - Active",
            "refId": "A"
          },
          {
            "expr": "hikaricp_connections_max{job=~\".*service.*\"}",
            "legendFormat": "{{job}} - Max",
            "refId": "B"
          }
        ]
      },
      {
        "id": 14,
        "title": "Service Discovery - Registered Instances",
        "type": "stat",
        "gridPos": {"h": 6, "w": 8, "x": 0, "y": 46},
        "targets": [
          {
            "expr": "eureka_server_registry_count",
            "legendFormat": "Registered Services",
            "refId": "A"
          }
        ]
      },
      {
        "id": 15,
        "title": "Circuit Breaker State by Service",
        "type": "stat",
        "gridPos": {"h": 6, "w": 8, "x": 8, "y": 46},
        "targets": [
          {
            "expr": "resilience4j_circuitbreaker_state{job=~\".*service.*\"}",
            "legendFormat": "{{job}} - {{name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 1, "color": "yellow"},
                {"value": 2, "color": "red"}
              ]
            },
            "mappings": [
              {"type": "value", "options": {"0": {"text": "CLOSED"}}},
              {"type": "value", "options": {"1": {"text": "HALF_OPEN"}}},
              {"type": "value", "options": {"2": {"text": "OPEN"}}}
            ]
          }
        }
      },
      {
        "id": 16,
        "title": "Thread Pool Usage",
        "type": "graph",
        "gridPos": {"h": 6, "w": 8, "x": 16, "y": 46},
        "targets": [
          {
            "expr": "jvm_threads_live_threads{job=~\".*service.*\"}",
            "legendFormat": "{{job}} - Threads",
            "refId": "A"
          }
        ]
      },
      {
        "id": 17,
        "title": "Garbage Collection Time",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 52},
        "targets": [
          {
            "expr": "rate(jvm_gc_pause_seconds_sum{job=~\".*service.*\"}[5m])",
            "legendFormat": "{{job}} - {{action}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "s", "label": "GC Time"},
          {"format": "short"}
        ]
      },
      {
        "id": 18,
        "title": "Favourite Service - Operations",
        "type": "graph",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 52},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=\"dev-favourite-service\"}[5m])) by (uri, status)",
            "legendFormat": "{{uri}} [{{status}}]",
            "refId": "A"
          }
        ]
      },
      {
        "id": 19,
        "title": "Request Success Rate by Service",
        "type": "graph",
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 60},
        "targets": [
          {
            "expr": "sum(rate(http_server_requests_seconds_count{job=~\".*service.*\", status!~\"5..\"}[5m])) by (job) / sum(rate(http_server_requests_seconds_count{job=~\".*service.*\"}[5m])) by (job) * 100",
            "legendFormat": "{{job}} - Success Rate",
            "refId": "A"
          }
        ],
        "yaxes": [
          {"format": "percent", "label": "Success Rate %", "min": 0, "max": 100},
          {"format": "short"}
        ]
      }
    ]
  },
  "overwrite": true
}
